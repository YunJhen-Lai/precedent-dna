<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>📘 Submit Precedent DNA Cases</title>
</head>
<body>
  <h2>📘 一鍵提交多筆案例到 GitHub 知識庫</h2>

  <p>請將下列格式貼入，按下按鈕即可送出所有案例：</p>
  <textarea id="json_input" rows="20" cols="100">[
  {
    "filename": ".json",
    "content": {
      "case_id": "",
      "project_name": "",
      "data_sources": ["GPT Analysis"],
      "Gene_A": {},
      "Gene_B": {},
      "Gene_C1": [],
      "Gene_C2": [],
      "Gene_D": {},
      "notes": "",
      "source": "GPT semantic analysis v1.0"
    }
  }
]</textarea>

  <br><br>
  <button onclick="submitAll()">📤 Submit All Cases</button>

  <script>
    function submitAll() {
      let inputText = document.getElementById("json_input").value;

      try {
        const cases = JSON.parse(inputText);

        if (!Array.isArray(cases)) {
          alert("請提供一個 JSON 陣列");
          return;
        }

        cases.forEach(data => {
          fetch("https://precedent-dna-webhook.yunjen20030303.repl.co/push_case", {
            method: "POST",
            headers: {
              "Content-Type": "application/json"
            },
            body: JSON.stringify({
              filename: data.filename,
              message: "Add " + data.filename,
              content: data.content
            })
          })
          .then(response => response.text())
          .then(text => console.log(`✅ ${data.filename} 回應：` + text))
          .catch(error => console.error(`❌ ${data.filename} 發送錯誤：`, error));
        });

        alert("📨 所有案例已送出，請查看 GitHub Repo！");
      } catch (e) {
        alert("⚠️ JSON 格式錯誤，請再次確認輸入");
        console.error(e);
      }
    }
  </script>
</body>
</html>
